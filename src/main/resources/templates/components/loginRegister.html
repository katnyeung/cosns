<!-- components/header.html -->
<header th:fragment="loginRegisterScript">
	<script th:inline="javascript">
		main.controller('userController', function($scope, $http, $timeout, messageService) {
			$scope.login = function() {
				if ($scope.login.email) {
					$http({
						url : "/user/login",
						method : "POST",
						headers : {
							'Content-Type' : 'application/json'
						},
						data : {
							'email' : $scope.login.email,
							'password' : $scope.login.password,

						}
					}).then(function(response) {
						if (response.data.status == 'success') {

							messageService.setUser(response.data.user);
							$scope.message("Welcome.")
						} else {

							$scope.message(response.data.remarks)
						}

					});
				}
			};
			$scope.logout = function() {
				$http({
					url : "/user/logout",
					method : "GET",
					headers : {
						'Content-Type' : 'application/json'
					}
				}).then(function(response) {
					messageService.setUser(response.data.user);

				});
			};

			$scope.register = function() {
				if ($scope.register.email) {
					if ($scope.register.password == $scope.register.passwordAgain) {
						$http({
							url : "/user/register",
							method : "POST",
							headers : {
								'Content-Type' : 'application/json'
							},
							data : {
								'email' : $scope.register.email,
								'password' : $scope.register.password,
								'passwordAgain' : $scope.register.passwordAgain,
							}
						}).then(function(response) {
							$scope.message("Account Create Success");
							$scope.showRegister = false;
						});
					} else {
						$scope.message("please verify your password")
					}

				}
			};

			$scope.message = function(message) {
				messageService.setMessage(message);
			}

			messageService.setUser(/*[[${user}]]*/{});
			
			$scope.shared = messageService.getShared();
			console.log($scope.shared);
		});
	</script>
</header>
<header th:fragment="loginRegisterBody">

	<div ng-controller="userController">
		<ul class="nav">
			<li class="navbar-item"><a href="/c">Calendar</a></li>
			<li class="navbar-item"><a href="/t" ng-show="shared.user">Timeline</a></li>
			<li class="navbar-item"><a href="/w" ng-show="shared.user">Write</a></li>
		</ul>

		<div ng-hide="shared.user" class="nav pull-right">
			<form class="navbar-form" ng-submit="login()">
				<input class="span2" type="text" ng-model="login.email" name="email" placeholder="Email"> <input class="span2" type="password" ng-model="login.password" name="password" placeholder="Password">
				<button type="submit" class="btn">Sign in</button>
				<a href="#myModal" role="button" class="btn" ng-click="showRegister=true">Register</a>
			</form>
		</div>
		<div ng-show="shared.user" class="nav-pills pull-right">
			<a href="/u/">{{shared.user.email}}</a> &nbsp;<a href="/setting/">Setting</a> <a href="#" ng-click="logout()">Logout</a>
		</div>

		<div id="registerModal" ng-show="showRegister" class="modal">
			<div class="modal-header">
				<button type="button" class="close" ng-click="showRegister=false">&times;</button>
				<h3>Register</h3>
			</div>
			<form ng-submit="register()" name="registerForm">
				<div class="modal-body">
					<table>
						<tr>

							<td>Email :</td>
							<td><input type="text" ng-model="register.email" name="email" /></td>
						</tr>
						<tr>
							<td>Password :</td>
							<td><input type="password" ng-model="register.password" name="password" /></td>
						</tr>
						<tr>
							<td>Password Again :</td>
							<td><input type="password" ng-model="register.passwordAgain" name="passwordAgain" /></td>
						</tr>

					</table>


				</div>
				<div class="modal-footer">
					<a href="#" class="btn" ng-click="showRegister=false">Close</a> <input type="submit" id="register" value="register" class="btn btn-primary" />
				</div>
			</form>
		</div>

	</div>

</header>