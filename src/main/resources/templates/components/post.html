<header th:fragment="viewPostScript">
	<script>
		main.factory('postService', function($http) {
			var service = {};

			service.likePost = function(post) {
				console.log(post);
				return $http({
					url : "/post/likePost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : post.postId
					}
				}).then(function(response) {
					if (response.data.status === 'success') {
						if (response.data.type === 'incr') {
							post.likeCount++;
							post.liked = true;
						} else if (response.data.type === 'decr') {
							post.likeCount--;
							post.liked = false;
						}
					}
					return response;
				});
			};

			service.retweetPost = function(post) {

				post.retweetCount++;
				return $http({
					url : "/post/retweetPost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : post.postId
					}
				}).then(function(response) {
					if (response.data.status === 'success') {
						post.retweetCount++;
						post.retweeted = true;
					}
					return response;
				});
			};

			service.loadPosts = function(functionName) {
				return $http({
					url : "/post/" + functionName,
					method : "GET",
					headers : {
						'Content-Type' : 'application/json'
					}
				});
			};

			return service;
		});
	</script>
</header>

<body th:fragment="viewPosts(section)">

	<div ng-show="post.retweetedBy">
		<div class="row shadow-sm">
			<div class="col">
				<span style="font-size: 12px">/Retweet By</span>
				<span ng-repeat="retweetedByPost in post.retweetedBy">
					<a href="/u/{{retweetedByPost.user.uniqueName ? retweetedByPost.user.uniqueName : retweetedByPost.user.userId}}" style="font-size: 14px">{{retweetedByPost.user.uniqueName ? retweetedByPost.user.uniqueName : retweetedByPost.user.email}}</a>
				</span>
			</div>

			<div class="col-ml-auto" style="font-size: 10px">
				<a href="/p/{{post.postId}}">{{post.createdate | date:'MM/dd/yyyy hh:mm:ss'}}</a> &nbsp;
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col">
			{{post.postId}} <a href="/u/{{post.user.uniqueName ? post.user.uniqueName : post.user.userId}}" style="font-size: 14px">{{post.user.uniqueName ? post.user.uniqueName : post.user.email}}</a>
		</div>

		<div class="col-ml-auto" style="font-size: 10px">
			<a href="/p/{{post.postId}}">{{post.createdate | date:'MM/dd/yyyy hh:mm:ss'}}</a> &nbsp;
		</div>
	</div>
	<div th:include="components/post :: viewPostBody(${section})"></div>

</body>

<body th:fragment="viewPostBody(section)">
	<div ng-show="shared.user" class='navbar-form'>
		<div class="row">
			<div class="col-mr-1">
				<a href="#" class="btn" ng-click="likePost(post, post.postId); $event.preventDefault();"> <span ng-show="post.liked">Unlike</span> <span ng-show="!post.liked">Like</span> <span ng-show="post.likeCount > 0">{{post.likeCount}}</span>
				</a>
			</div>
			<div ng-show="!post.retweeted && shared.user.userId != post.user.userId">
				<a href="#" class="btn" ng-click="retweetPost(post); $event.preventDefault();"> Retweet <span ng-show="post.retweetCount > 0">{{post.retweetCount}}</span></a> <span ng-show="post.retweeted"> Retweet <span ng-show="post.retweetCount > 0">{{post.retweetCount}}</span></span>
			</div>
		</div>
	</div>
	<div ng-show="!shared.user">
		Like <span ng-show="post.likeCount > 0">{{post.likeCount}}</span> Retweet <span ng-show="post.retweetCount > 0">{{post.retweetCount}}</span>
	</div>

	<div>
		<th:block th:switch="${section}">
			<div th:case="'detail'">
				<div th:attr="ng-repeat='image in post.postImages'">
					<img src="/images/{{image.filename}}" class="img-fluid m-1 rounded" />
				</div>
			</div>
			<div th:case="'thumbnail'">
				<a href="/p/{{post.postId}}">
					<div th:attr="ng-repeat='image in post.postImages | limitTo:1'">
						<img src="/images/{{image.filename}}" class="img-fluid m-1 rounded" />
					</div>
					<div class="row m-0 p-1">
						<div class="col-md-4 m-0 p-1" th:attr="ng-repeat='image in post.postImages | limitTo:5:1'">
							<img src="/images/{{image.filename}}" class="img-fluid m-1 rounded" />
						</div>
					</div>
				</a>
			</div>
			<div th:case="'thumbnail-mid'">
				<a href="/p/{{post.postId}}">
					<div th:attr="ng-repeat='image in post.postImages | limitTo:1'">
						<img src="/images/{{image.filename}}" class="img-fluid m-1 rounded" />
					</div>
					<div class="row m-0 p-1">
						<div class="col-md-5 m-0 p-1" th:attr="ng-repeat='image in post.postImages | limitTo:5:1'">
							<img src="/images/{{image.filename}}" class="img-fluid m-1 rounded" />
						</div>
					</div>
				</a>
			</div>
		</th:block>

	</div>

	<pre>{{post.message}}</pre>
</body>
