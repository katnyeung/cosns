<header th:fragment="viewPostScript">
	<script>
		main.factory('postService', function($http) {
			var service = {};

			service.likePost = function(post) {
				return $http({
					url : "/post/likePost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : post.postId
					}
				}).then(function(response) {
					if (response.data.status === 'success') {
						if (response.data.type === 'incr') {
							post.likeCount++;
							post.liked = true;
						} else if (response.data.type === 'decr') {
							post.likeCount--;
							post.liked = false;
						}
					}
					return response;
				});
			};

			service.retweetPost = function(post) {

				post.retweetCount++;
				return $http({
					url : "/post/retweetPost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : post.postId
					}
				}).then(function(response) {
					if (response.data.status === 'success') {
						post.retweetCount++;
						post.retweeted = true;
					}
					return response;
				});
			};

			service.loadPosts = function(functionName) {
				return $http({
					url : "/post/" + functionName,
					method : "GET",
					headers : {
						'Content-Type' : 'application/json'
					}
				});
			};

			return service;
		});
	</script>
</header>

<body th:fragment="viewPosts">

	<div ng-repeat="post in postList" class="span4">
		<div>
			#{{post.postId}} <a href="/u/{{post.user.userId}}">{{post.user.email}}</a>
			&nbsp; <a href="/p/{{post.postId}}">{{post.createdate |
				date:'MM/dd/yyyy hh:mm:ss'}}</a>
		</div>

		<div ng-show="post.type == 'retweet'" class="well">
			{{postContent = post.post;""}}
			<div>
				Retweet <a href="/u/{{postContent.user.userId}}">{{postContent.user.email}}</a>
				&nbsp; <a href="/p/{{postContent.postId}}">{{postContent.createdate
					| date:'MM/dd/yyyy hh:mm:ss'}}</a>
			</div>
			<div>
				<div th:include="components/post :: viewPostBody"></div>
			</div>
		</div>

		<div ng-show="post.type !='retweet'">
			{{postContent = post;""}}

			<div th:include="components/post :: viewPostBody"></div>
		</div>
	</div>

</body>

<body th:fragment="viewPostBody">
	<pre>{{postContent.message}}</pre>
	<div class="container">
		<div ng-repeat="image in postContent.postImages">
			<img class="span2" src="/images/{{image.filename}}" />
		</div>
	</div>
	<div class="container">
		<div ng-show="shared.user">
			<a href="#" class="btn"
				ng-click="likePost(postContent); $event.preventDefault();"> <span
				ng-show="postContent.liked">Unlike</span> <span
				ng-show="!postContent.liked">Like</span> <span ng-show="postContent.likeCount > 0">{{postContent.likeCount}}</span>
			</a> <span
				ng-show="!postContent.retweeted && shared.user.userId != postContent.user.userId">
				<a href="#" class="btn"
				ng-click="retweetPost(postContent); $event.preventDefault();">
					Retweet <span ng-show="postContent.retweetCount > 0">{{postContent.retweetCount}}</span> </a>
			</span>
			<span ng-show="postContent.retweeted">
			Retweet <span ng-show="postContent.retweetCount > 0">{{postContent.retweetCount}}</span></span>
		</div>
		<div ng-show="!shared.user">Like <span ng-show="postContent.likeCount > 0">{{postContent.likeCount}}</span>
			Retweet <span ng-show="postContent.retweetCount > 0">{{postContent.retweetCount}}</span></div>
	</div>
</body>