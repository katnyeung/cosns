<!doctype html>
<html lang="en">
<head>

<script th:include="components/header :: headerLibrary" th:remove="tag"></script>

</head>
<body ng-app="application">
	<script>
		var main = angular.module('application', []);

		main.controller('searchController', function($scope, $http) {

			$scope.search = function() {
				$http({
					url : "/post/searchPosts",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						keyword : $scope.keyword
					}
				}).then(function(response) {
					$scope.postList = response.data.postList;
				});
			}

		});
		main.controller('viewPostController', function($scope, postService, messageService) {
			$scope.shared = messageService.getShared();
			
			var handleResponse = function(response, type) {
				if (response.data.status == 'success') {
					$scope.message(type + " success");
				} else {
					$scope.message(type + " failed : " + response.data.remarks);
				}
			}

			$scope.likePost = function(postId) {
				postService.likePost(postId).then(function(response) {
					//handleResponse(response, 'like');
				});
			}

			$scope.retweetPost = function(postId) {
				postService.retweetPost(postId).then(function(response) {
					handleResponse(response, 'retweet');
				});
			}

			postService.loadPosts("getRandomPosts").then(function(response) {
				$scope.postList = response.data.postList;
			});

			$scope.message = function(message) {
				messageService.setMessage(message);
			}

		});
	</script>
	<div th:include="components/post :: viewPostScript" th:remove="tag"></div>

	<div th:include="components/header :: headerScript" th:remove="tag"></div>
	<div th:include="components/header :: headerBody" th:remove="tag"></div>

	<div class="container">
		<div ng-controller="searchController" class="hero-unit">
			<!-- Main hero unit for a primary marketing message or call to action -->
			Search <input type="text" ng-mode="keyword" />
			<button type="button" ng-click="search()">Search</button>

		</div>

		<div ng-controller="viewPostController" class="row-fluid">
			<div th:include="components/post :: viewPosts" th:remove="tag"></div>
		</div>

	</div>
	<hr>

	<footer>
		<p>&copy; Company 2013</p>
	</footer>



</body>
</html>