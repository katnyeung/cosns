<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Example - example-ng-submit</title>

<script th:include="components/header :: headerLibrary" th:remove="tag"></script>

</head>
<body ng-app="application">
	<script>
		var main = angular.module('application', []);
		main.factory('postService', function($http) {
			var service = {};

			service.likePost = function(postId) {
				return $http({
					url : "/post/likePost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : postId
					}
				});
			};

			service.retweetPost = function(postId) {
				return $http({
					url : "/post/retweetPost",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						postId : postId
					}
				});
			};
			service.loadPosts = function(functionName) {
				return $http({
					url : "/post/" + functionName,
					method : "GET",
					headers : {
						'Content-Type' : 'application/json'
					}
				});
			};

			return service;
		});

		main.controller('searchController', function($scope, $http) {

			$scope.search = function() {
				$http({
					url : "/post/searchPosts",
					method : "POST",
					headers : {
						'Content-Type' : 'application/json'
					},
					data : {
						keyword : $scope.keyword
					}
				}).then(function(response) {
					$scope.postList = response.data.postList;
				});
			}

		});

		main.controller('viewPostController', function($scope, $timeout, postService) {
			var handleResponse = function(response, type) {
				if (response.data.status == 'success') {
					$scope.message(type + " Success");
				} else {
					$scope.message(type + " Failed");
				}
			}
			
			postService.likePost.then(function(response) {
				handleResponse(response, 'like')
			});

			postService.retweetPost.then(function(response) {
				handleResponse(response, 'retweet')
			});

			
			$scope.postList = postService.loadPosts("getRandomPosts");

			$scope.message = function(message) {

				$scope.dialogMessageFlag = true;
				$scope.dialogMessage = message;

				$timeout(function() {
					$scope.dialogMessageFlag = false;
				}, 3000);

			}

		});
	</script>

	<div th:include="components/header :: headerScript" th:remove="tag"></div>
	<div th:include="components/header :: headerBody" th:remove="tag"></div>

	<div class="container">
		<div ng-controller="searchController" class="hero-unit">
			<!-- Main hero unit for a primary marketing message or call to action -->
			Search <input type="text" ng-mode="keyword" />
			<button type="button" ng-click="search()">Search</button>

		</div>

		<div ng-controller="viewPostController" class="row offset1">
			<div th:include="components/post :: viewPosts" th:remove="tag"></div>
			<div id="postMessage" ng-show="dialogMessageFlag" ng-init="dialogMessageFlag = false" class="alert modal">
				<span class="row offset2">{{dialogMessage}} <a href="#" class="close" ng-click="dialogMessageFlag = false">X</a></span>
			</div>
		</div>

	</div>
	<hr>

	<footer>
		<p>&copy; Company 2013</p>
	</footer>



</body>
</html>