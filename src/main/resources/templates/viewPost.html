<!doctype html>
<html lang="en">
<head>

<script th:include="components/header :: headerLibrary" th:remove="tag"></script>

<script>
	var main = angular.module('application', [ 'ngSanitize' ]);

	main.controller('viewPostController', function($scope, postService, messageService) {

		postService.setMessageService(messageService);

		$scope.likePost = function(postId) {
			postService.likePost(postId, 'viewPost');
		}
		$scope.retweetPost = function(postId) {
			postService.retweetPost(postId, 'viewPost');
		}
		$scope.removePost = function(postId) {
			postService.removePost(postId, 'viewPost');
		}
		$scope.loadPost = function(handler) {
			postService.loadPosts("getPost/[[${postId}]]", handler);
		}

		var handler = function(postList) {
			$scope.postList = postList;
		}

		$scope.loadPost(handler);

		$scope.shared = messageService.getShared();

		$scope.$watch('shared.user', function(newValue, oldValue) {
			if (newValue != oldValue) {
				$scope.loadPost(handler);
			}
		});

	});
</script>
</head>
<body ng-app="application">

	<div th:include="components/post :: viewPostScript" th:remove="tag"></div>
	<div th:include="components/header :: headerScript" th:remove="tag"></div>
	<div th:include="components/header :: headerBody" th:remove="tag"></div>

	<div class="container">
		<div ng-controller="viewPostController" class="row">
			<div ng-repeat="post in postList">
				<hr />
				<div th:include="components/post :: viewPosts('detail')" th:remove="tag"></div>
			</div>
		</div>
	</div>
	<hr>

	<footer>
		<p>&copy; Company 2013</p>
	</footer>
</body>
</html>